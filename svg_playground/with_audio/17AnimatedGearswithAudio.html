<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">  
  <title>17 Animated Gears with Audio</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <!--  Remove this line in production. -->
</head>

<body>
  <div style="text-align: center;"> <!-- Center everything. -->
    <div style=" margin-bottom: 8px;">
	    <button id="startButton" type="button" onclick="startAnim();">Start</button>
	    <button type="button" onclick="increaseAnim();">+</button>
      <button type="button" onclick="decreaseAnim();">â€“</button>	  
	    <button type="button" onclick="pauseAnim();">Pause</button>
	    <button type="button" onclick="resetAnim();">Reset</button>    
	    <button id="soundButton" type="button" onclick="toggleAudio();">Sound Off</button>  
    </div>
    <svg id="svgElement" width="800px" height="800px" viewBox="0 0 800 800"> <!-- Give the svg element a name so that we can easily access it via JavaScript. -->
      <rect x="0" y="0" width="100%" height="100%" rx="16" ry="16" style="fill: none; stroke: black; stroke-dasharray: 10, 5;"></rect>
      <g id="coordinateFrame" transform="translate(400, 400)"> <!-- Create a Cartesian coordinate system (with the y-axis flipped) for the animated gears. That is, place the origin at the center of the 800 x 800 SVG viewport: -->
        <!-- Gear <g> elements will be appended here via JavaScript. -->
      <g id="gear0" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle0" cx="0" cy="0" r="200" style="fill: rgb(175, 162, 166);"></circle><line id="gearHLine0" x1="-200" y1="0" x2="200" y2="0" style="stroke: white;"></line><line id="gearVLine0" x1="0" y1="-200" x2="0" y2="200" style="stroke: white;"></line><text id="gearNumberText0" x="0" y="0" transform="translate(3, -3)" font-size="10">#0</text><text id="gearRadiusText0" x="0" y="0" transform="translate(3, 10)" font-size="10">r = 200</text></g><g id="gear1" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle1" cx="275" cy="0" r="75" style="fill: rgb(165, 145, 148);"></circle><line id="gearHLine1" x1="200" y1="0" x2="350" y2="0" style="stroke: white;"></line><line id="gearVLine1" x1="275" y1="-75" x2="275" y2="75" style="stroke: white;"></line><text id="gearNumberText1" x="275" y="0" transform="translate(3, -3)" font-size="10">#1</text><text id="gearRadiusText1" x="275" y="0" transform="translate(3, 10)" font-size="10">r = 75</text></g><g id="gear2" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle2" cx="275" cy="112.5" r="37.5" style="fill: rgb(186, 66, 215);"></circle><line id="gearHLine2" x1="237.5" y1="112.5" x2="312.5" y2="112.5" style="stroke: white;"></line><line id="gearVLine2" x1="275" y1="75" x2="275" y2="150" style="stroke: white;"></line><text id="gearNumberText2" x="275" y="112.5" transform="translate(3, -3)" font-size="10">#2</text><text id="gearRadiusText2" x="275" y="112.5" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear3" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle3" cx="275" cy="275" r="125" style="fill: rgb(220, 124, 130);"></circle><line id="gearHLine3" x1="150" y1="275" x2="400" y2="275" style="stroke: white;"></line><line id="gearVLine3" x1="275" y1="150" x2="275" y2="400" style="stroke: white;"></line><text id="gearNumberText3" x="275" y="275" transform="translate(3, -3)" font-size="10">#3</text><text id="gearRadiusText3" x="275" y="275" transform="translate(3, 10)" font-size="10">r = 125</text></g><g id="gear4" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle4" cx="112.5" cy="275" r="37.5" style="fill: rgb(133, 194, 208);"></circle><line id="gearHLine4" x1="75" y1="275" x2="150" y2="275" style="stroke: white;"></line><line id="gearVLine4" x1="112.5" y1="237.5" x2="112.5" y2="312.5" style="stroke: white;"></line><text id="gearNumberText4" x="112.5" y="275" transform="translate(3, -3)" font-size="10">#4</text><text id="gearRadiusText4" x="112.5" y="275" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear5" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle5" cx="0" cy="275" r="75" style="fill: rgb(67, 146, 173);"></circle><line id="gearHLine5" x1="-75" y1="275" x2="75" y2="275" style="stroke: white;"></line><line id="gearVLine5" x1="0" y1="200" x2="0" y2="350" style="stroke: white;"></line><text id="gearNumberText5" x="0" y="275" transform="translate(3, -3)" font-size="10">#5</text><text id="gearRadiusText5" x="0" y="275" transform="translate(3, 10)" font-size="10">r = 75</text></g><g id="gear6" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle6" cx="-112.5" cy="275" r="37.5" style="fill: rgb(146, 76, 89);"></circle><line id="gearHLine6" x1="-150" y1="275" x2="-75" y2="275" style="stroke: white;"></line><line id="gearVLine6" x1="-112.5" y1="237.5" x2="-112.5" y2="312.5" style="stroke: white;"></line><text id="gearNumberText6" x="-112.5" y="275" transform="translate(3, -3)" font-size="10">#6</text><text id="gearRadiusText6" x="-112.5" y="275" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear7" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle7" cx="-275" cy="275" r="125" style="fill: rgb(71, 152, 197);"></circle><line id="gearHLine7" x1="-400" y1="275" x2="-150" y2="275" style="stroke: white;"></line><line id="gearVLine7" x1="-275" y1="150" x2="-275" y2="400" style="stroke: white;"></line><text id="gearNumberText7" x="-275" y="275" transform="translate(3, -3)" font-size="10">#7</text><text id="gearRadiusText7" x="-275" y="275" transform="translate(3, 10)" font-size="10">r = 125</text></g><g id="gear8" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle8" cx="-275" cy="112.5" r="37.5" style="fill: rgb(193, 130, 211);"></circle><line id="gearHLine8" x1="-312.5" y1="112.5" x2="-237.5" y2="112.5" style="stroke: white;"></line><line id="gearVLine8" x1="-275" y1="75" x2="-275" y2="150" style="stroke: white;"></line><text id="gearNumberText8" x="-275" y="112.5" transform="translate(3, -3)" font-size="10">#8</text><text id="gearRadiusText8" x="-275" y="112.5" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear9" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle9" cx="-275" cy="0" r="75" style="fill: rgb(164, 230, 88);"></circle><line id="gearHLine9" x1="-350" y1="0" x2="-200" y2="0" style="stroke: white;"></line><line id="gearVLine9" x1="-275" y1="-75" x2="-275" y2="75" style="stroke: white;"></line><text id="gearNumberText9" x="-275" y="0" transform="translate(3, -3)" font-size="10">#9</text><text id="gearRadiusText9" x="-275" y="0" transform="translate(3, 10)" font-size="10">r = 75</text></g><g id="gear10" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle10" cx="-275" cy="-112.5" r="37.5" style="fill: rgb(114, 135, 82);"></circle><line id="gearHLine10" x1="-312.5" y1="-112.5" x2="-237.5" y2="-112.5" style="stroke: white;"></line><line id="gearVLine10" x1="-275" y1="-150" x2="-275" y2="-75" style="stroke: white;"></line><text id="gearNumberText10" x="-275" y="-112.5" transform="translate(3, -3)" font-size="10">#10</text><text id="gearRadiusText10" x="-275" y="-112.5" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear11" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle11" cx="-275" cy="-275" r="125" style="fill: rgb(214, 162, 131);"></circle><line id="gearHLine11" x1="-400" y1="-275" x2="-150" y2="-275" style="stroke: white;"></line><line id="gearVLine11" x1="-275" y1="-400" x2="-275" y2="-150" style="stroke: white;"></line><text id="gearNumberText11" x="-275" y="-275" transform="translate(3, -3)" font-size="10">#11</text><text id="gearRadiusText11" x="-275" y="-275" transform="translate(3, 10)" font-size="10">r = 125</text></g><g id="gear12" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle12" cx="-112.5" cy="-275" r="37.5" style="fill: rgb(229, 205, 90);"></circle><line id="gearHLine12" x1="-150" y1="-275" x2="-75" y2="-275" style="stroke: white;"></line><line id="gearVLine12" x1="-112.5" y1="-312.5" x2="-112.5" y2="-237.5" style="stroke: white;"></line><text id="gearNumberText12" x="-112.5" y="-275" transform="translate(3, -3)" font-size="10">#12</text><text id="gearRadiusText12" x="-112.5" y="-275" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear13" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle13" cx="0" cy="-275" r="75" style="fill: rgb(225, 89, 118);"></circle><line id="gearHLine13" x1="-75" y1="-275" x2="75" y2="-275" style="stroke: white;"></line><line id="gearVLine13" x1="0" y1="-350" x2="0" y2="-200" style="stroke: white;"></line><text id="gearNumberText13" x="0" y="-275" transform="translate(3, -3)" font-size="10">#13</text><text id="gearRadiusText13" x="0" y="-275" transform="translate(3, 10)" font-size="10">r = 75</text></g><g id="gear14" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle14" cx="112.5" cy="-275" r="37.5" style="fill: rgb(219, 108, 88);"></circle><line id="gearHLine14" x1="75" y1="-275" x2="150" y2="-275" style="stroke: white;"></line><line id="gearVLine14" x1="112.5" y1="-312.5" x2="112.5" y2="-237.5" style="stroke: white;"></line><text id="gearNumberText14" x="112.5" y="-275" transform="translate(3, -3)" font-size="10">#14</text><text id="gearRadiusText14" x="112.5" y="-275" transform="translate(3, 10)" font-size="10">r = 37.5</text></g><g id="gear15" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle15" cx="275" cy="-275" r="125" style="fill: rgb(230, 124, 105);"></circle><line id="gearHLine15" x1="150" y1="-275" x2="400" y2="-275" style="stroke: white;"></line><line id="gearVLine15" x1="275" y1="-400" x2="275" y2="-150" style="stroke: white;"></line><text id="gearNumberText15" x="275" y="-275" transform="translate(3, -3)" font-size="10">#15</text><text id="gearRadiusText15" x="275" y="-275" transform="translate(3, 10)" font-size="10">r = 125</text></g><g id="gear16" transform="matrix(1, 0, 0, 1, 0, 0)"><circle id="gearCircle16" cx="275" cy="-112.5" r="37.5" style="fill: rgb(222, 105, 210);"></circle><line id="gearHLine16" x1="237.5" y1="-112.5" x2="312.5" y2="-112.5" style="stroke: white;"></line><line id="gearVLine16" x1="275" y1="-150" x2="275" y2="-75" style="stroke: white;"></line><text id="gearNumberText16" x="275" y="-112.5" transform="translate(3, -3)" font-size="10">#16</text><text id="gearRadiusText16" x="275" y="-112.5" transform="translate(3, 10)" font-size="10">r = 37.5</text></g></g>
    </svg>
  </div>
  <script>
    "use strict";

    /* -- GLOBALS -------------------------------------------------------------------------------------------- */

    var constants = {}; // Used to store global constants, see setConstants().
    var gears = []; // An array that will contain the gears to be animated (plus additional information, such as gear position).
    var requestAnimationFrameID;
    var myAudio; // Represents the HTML5 audio object.

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    document.addEventListener('DOMContentLoaded', setupGears, false); // Initialize the gears.

    /* -- HELPER FUNCTIONS ----------------------------------------------------------------------------------- */

    /*
      Create a single global variable that contains all required constants.
    */
    function setConstants() {
      constants.gearCrossBarColor = "white"; // The color of the vertical and horizontal lines on the circular gears.
      constants.gearFontSize = 10; // Font size of the text displayed on the gears.
      constants.driveGearIndex = 0; // The array index for the drive gear, which is the largest gear (labeled "#0"). All the other smaller gears are idler gears.
      constants.initialDriveGearSpeed = 0.3; // The amount, in degrees, to initially rotate the central drive gear about every 16.7 milliseconds (this speed value, of course, affects the speed of all the idler gears).
      constants.driveGearDelta = 0.05; // This is the amount to increase/decrease the rotational speed of the drive gear when a user clicks the a "+" or "-" button.
      constants.stoppedTurningThreshold = 0.01; // If the rotational speed of the drive gear is less than or equal to this constant, then the gears have visibly stopped turning.
      constants.audioFilePath = "./waUmp.mp3"; // File path to the audio file to play.
      constants.initialPlaybackRate = 3; // The initial playback rate for the audio file. Start out relatively fast so when the user repeatedly clicks the "-" button, it sounds relatively OK.
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    /*
      Returns true if the browser supports HTML5 with inline SVG, false otherwise. Assumes that the root SVG
      element has an ID value of "svgElement".
    */
    function svgSupported() {
      return (svgElement.namespaceURI == "http://www.w3.org/2000/svg");
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    /*
      Returns and RBG color value string, as in "rgb(120, 70, 255)". Stay away from overly dark and light
      colors. That is, we avoid RGB values below 60 (i.e., too dark) and RGB values above 230 (i.e., too light).

      Note that Math.floor( Math.random() * 171 ) generates a random integer between 0 and 170. Thus, adding
      60 to this range gives you a random integer between 60 and 230.
    */
    function getRandomColor() {
      var randomColor1 = Math.floor(Math.random() * 171) + 60; // Generates a random integer between 60 and 230.
      var randomColor2 = Math.floor(Math.random() * 171) + 60;
      var randomColor3 = Math.floor(Math.random() * 171) + 60;

      return ("rgb(" + randomColor1 + ", " + randomColor2 + ", " + randomColor3 + ")");
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    /*
      Returns true if the gears have visibly stopped turning. False otherwise.
    */
    function gearsHaveStopped() {
      return (Math.abs(gears[constants.driveGearIndex].speed) <= constants.stoppedTurningThreshold);
    }

    /* -- ANIMATION SETUP FUNCTIONS -------------------------------------------------------------------------- */

    /*
      Assumes that this function is called after the page loads.
    */
    function initializeGearsArray() {
      gears =
      [
        { r: 200, x: 0, y: 0, clockwise: +1 },
        { r: 75, x: 275, y: 0, clockwise: -1 },
        { r: 37.5, x: 275, y: 112.5, clockwise: +1 },
        { r: 125, x: 275, y: 275, clockwise: -1 },
        { r: 37.5, x: 112.5, y: 275, clockwise: +1 },
        { r: 75, x: 0, y: 275, clockwise: -1 },
        { r: 37.5, x: -112.5, y: 275, clockwise: +1 },
        { r: 125, x: -275, y: 275, clockwise: -1 },
        { r: 37.5, x: -275, y: 112.5, clockwise: +1 },
        { r: 75, x: -275, y: 0, clockwise: -1 },
        { r: 37.5, x: -275, y: -112.5, clockwise: +1 },
        { r: 125, x: -275, y: -275, clockwise: -1 },
        { r: 37.5, x: -112.5, y: -275, clockwise: +1 },
        { r: 75, x: 0, y: -275, clockwise: -1 },
        { r: 37.5, x: 112.5, y: -275, clockwise: +1 },
        { r: 125, x: 275, y: -275, clockwise: -1 },
        { r: 37.5, x: 275, y: -112.5, clockwise: +1 }
      ]; // Define the radius of each gear, its center, and its normal direction of rotation.

      for (var i = 0; i < gears.length; i++) {
        gears[i].index = i; // A gear object should know what gear it is.
        gears[i].name = "gear" + i; // The ID name used for each gear <g> group.
        gears[i].currentAngle = 0; // All gears start out with 0 degrees of initial rotation.
        gears[i].color = getRandomColor(); // A gear's color.
        gears[i].circleName = "gearCircle" + i; // This information is needed so that we can reset the gear colors when the Reset button is pressed.
      }

      gears[constants.driveGearIndex].speed = constants.initialDriveGearSpeed; // Set the current speed of the drive gear to its default (that is, initial) value. Note that as the user clicks the "+" or "-" buttons, this custom "speed" property value increases and decreases, respectively.
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function appendGearGElement(gear) {
      var gearGElement; // Each gear <g> element will contain all the graphics required for a gear, and said <g> element will be named "gear0", "gear1", "gear2", etc.

      gearGElement = document.createElementNS("http://www.w3.org/2000/svg", "g"); // Create a generic SVG <g> element.
      gearGElement.id = gear.name; // This is a gear object that will be animated.
      coordinateFrame.appendChild(gearGElement); // Append the gear object to the coordinate frame element.
      return (gearGElement); // Return the <g> element object so that other gear graphic elements can be attached to it later on.
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function appendGearCircleElement(gear, appendElement) {
      var gearCircleElement; // The basic shape of a gear is a colored circle.

      gearCircleElement = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      gearCircleElement.id = gear.circleName;
      gearCircleElement.cx.baseVal.value = gear.x;
      gearCircleElement.cy.baseVal.value = gear.y;
      gearCircleElement.r.baseVal.value = gear.r;
      gearCircleElement.style.fill = gear.color;
      appendElement.appendChild(gearCircleElement); // Append this gear circle to its containing <g> element.
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function appendGearCrossbarElements(gear, appendElement) {
      var gearLineElement; // Represents a horizontal or vertical line on the gear surface.

      gearLineElement = document.createElementNS("http://www.w3.org/2000/svg", "line");
      gearLineElement.id = "gearHLine" + gear.index;
      gearLineElement.x1.baseVal.value = gear.x - gear.r;
      gearLineElement.y1.baseVal.value = gear.y;
      gearLineElement.x2.baseVal.value = gear.x + gear.r;
      gearLineElement.y2.baseVal.value = gear.y;
      gearLineElement.style.stroke = "white";
      appendElement.appendChild(gearLineElement);

      gearLineElement = document.createElementNS("http://www.w3.org/2000/svg", "line");
      gearLineElement.id = "gearVLine" + gear.index;
      gearLineElement.x1.baseVal.value = gear.x;
      gearLineElement.y1.baseVal.value = gear.y - gear.r;
      gearLineElement.x2.baseVal.value = gear.x;
      gearLineElement.y2.baseVal.value = gear.y + gear.r;
      gearLineElement.style.stroke = constants.gearCrossBarColor;
      appendElement.appendChild(gearLineElement);
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    /*
      For comparison purposes, this function uses DOM L2 scripting.
    */
    function appendGearTextElements(gear, appendElement) {
      var gearTextElement;

      gearTextElement = document.createElementNS("http://www.w3.org/2000/svg", "text");
      gearTextElement.id = "gearNumberText" + gear.index;
      gearTextElement.setAttribute("x", gear.x);
      gearTextElement.setAttribute("y", gear.y);
      gearTextElement.setAttribute("transform", "translate(3, -3)"); // Offset the text from the center of the circle.
      gearTextElement.textContent = "#" + gear.index;
      gearTextElement.setAttribute("font-size", constants.gearFontSize);
      appendElement.appendChild(gearTextElement);

      gearTextElement = document.createElementNS("http://www.w3.org/2000/svg", "text");
      gearTextElement.id = "gearRadiusText" + gear.index;
      gearTextElement.setAttribute("x", gear.x);
      gearTextElement.setAttribute("y", gear.y);
      gearTextElement.setAttribute("transform", "translate(3, 10)");
      gearTextElement.textContent = "r = " + gear.r;
      gearTextElement.setAttribute("font-size", constants.gearFontSize);
      appendElement.appendChild(gearTextElement);
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function createGearElements() {
      var gearGElement;

      for (var i = 0; i < gears.length; i++) {
        gearGElement = appendGearGElement(gears[i]); // Create a named <g> element and append it to the "coordinateFrame" element.
        appendGearCircleElement(gears[i], gearGElement); // Create a named <circle> element, representing part of a gear, and attach it to the "gearGElement" group.
        appendGearCrossbarElements(gears[i], gearGElement); // Now add the crossbars to a gear <g> group.
        appendGearTextElements(gears[i], gearGElement); // And finally print some useful info onto the surface of the gear.
      }
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function loadGearsArray() {
      var transformObject = svgElement.createSVGTransform(); // Create a generic SVG transform object so as to gain access to its methods and properties, such as setRotate().;

      for (var i = 0; i < gears.length; i++) {
        gears[i].obj = document.getElementById(gears[i].name); // Acquire the gear object (i.e., the <g> element) associated with the given gear element ID name. This gear object will be incrementally rotated at a given center point.
        gears[i].obj.transform.baseVal.appendItem(transformObject); // Append a transform object to a gear, now the gear object has inherited all the transform object's goodness such as access to the method setRotate().
      }
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function setupGears() {
      if (!svgSupported()) { // Bail if the browser doesn't support HTML5 with inline SVG.
        alert("Inline SVG in HTML5 is not supported. This document requires a browser that supports HTML5 and inline SVG.");
        return; // Do not execute the following lines of code in this function.
      }

      setConstants(); // Add all required constant values to the global "constants".
      initializeGearsArray(); // Add basic gear information, such as gear location and size.
      createGearElements(); // Creates gear related elements and inserts them into the DOM.
      loadGearsArray(); // This must be called after createGearElements(). These gear <g> elements will be incrementally rotated when animated.
      initializeAudio(); // Get the audio file ready to play in a loop.
    }

    /* -- ANIMATION FUNCTIONS -------------------------------------------------------------------------------- */

    function doAnim() {
      for (var i = 0; i < gears.length; i++) {
        gears[i].obj.transform.baseVal.getItem(0).setRotate(gears[i].currentAngle, gears[i].x, gears[i].y); // Rotate the i'th gear about the gear's center point.
        // gears[i].obj.setAttribute("transform", "rotate(" + gears[i].currentAngle + ", " + gears[i].x + ", " + gears[i].y + ")"); // More cross-browser friendly, slightly less performant. Note that you don't technically need to append a transform object to each gear object, in loadGearsArray(), when using this line.
        gears[i].currentAngle += (gears[i].clockwise * gears[constants.driveGearIndex].speed * (gears[constants.driveGearIndex].r / gears[i].r)); // Calculate the appropriate rotational speed of the gear based on it's radius.
        if (gears[i].currentAngle >= 360) { // Don't let "currentAngle" get crazy big.
          gears[i].currentAngle -= 360; // Keeps "currentAngle" between 0 and about 360 degrees.
        } // if
      } // for
      requestAnimationFrameID = requestAnimationFrame(doAnim); // Call the doAnim() function about every 16.7 milliseconds (about 60 frames per second) until "requestAnimationFrameID" is cleared.
    } // doAnim()

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function startAnim() {
      if ( gearsHaveStopped() ) { // It's possible for a user to set the rotational speed to a value very close to 0 (or 0 itself) by clicking the "+" or "-" buttons (which can happen while the animation is paused).
        alert('If you see no movement,\npress a "+" or "-" button."'); // Explain to the user why the animation is "not working" even though they've pressed the Start button.
      }

      if (!startButton.startButtonClicked) { // Don't allow multiple instance of the function specified by requestAnimationFrame to be invoked by the browser. Note that button.startButtonClicked will be undefined on first use, which is effectively the same as false.
        /* Only do the following once per animation: */
        startAudio(); // Play the audio only if the Start button has been clicked.
        startButton.startButtonClicked = true; // A custom property is attached to the button object to track whether the button has been clicked or not.
        requestAnimationFrameID = requestAnimationFrame(doAnim); // Start the animation loop.
      }
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function increaseAnim() {
      if (startButton.startButtonClicked) { // Only change the speed of the gears if they've started rotating.
        gears[constants.driveGearIndex].speed += constants.driveGearDelta; // Increase the rotational speed of the drive gear, which increases the rotational speed of all the other gears.
        setAudioSpeed(); // Set the audio playback speed based on the absolute value of the rotational speed of the drive gear.
      }
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function decreaseAnim() {
      if (startButton.startButtonClicked) { // Only change the speed of the gears if they've started rotating.
        gears[constants.driveGearIndex].speed -= constants.driveGearDelta; // Decrease the rotational speed of the drive gear, which decreases the rotational speed of all the other gears.
        setAudioSpeed(); // Set the audio playback speed based on the absolute value of the rotational speed of the drive gear.
      }
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function pauseAnim() {
      cancelAnimationFrame(requestAnimationFrameID); // Stop calling the doAnim() function.
      pauseAudio(); // At last, blissful silence.
      startButton.startButtonClicked = false; // Allow requestAnimationFrame() to be called if the Start button is clicked again. And disable the "+" or "-" buttons when paused.
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function resetAnim() {
      var gearCircleElement; // Represents the circle element of a given gear <g> group.

      cancelAnimationFrame(requestAnimationFrameID); // Stop calling the doAnim() function.

      /* Set the angular value for all gears to 0 and choose new random colors for the gear circles: */
      for (var i = 0; i < gears.length; i++) {
        gears[i].currentAngle = 0; // Set a gear's current rotational angle to its inital value of 0.
        gears[i].obj.transform.baseVal.getItem(0).setRotate(gears[i].currentAngle, gears[i].x, gears[i].y); // Rotate the given gear back to its initial value of 0 degrees (about it's center).
        // gears[i].obj.setAttribute("transform", "rotate(" + gears[i].currentAngle + ", " + gears[i].x + ", " + gears[i].y + ")"); // Does the same thing as the above line but is more cross-browser friendly but slighly less performant.
        gears[i].color = getRandomColor(); // Returns a random color in the form of an RGB string.
        gearCircleElement = document.getElementById(gears[i].circleName); // Grab the gear's circle element.
        gearCircleElement.style.fill = gears[i].color; // Set the gear's circle color.
      }

      gears[constants.driveGearIndex].speed = constants.initialDriveGearSpeed; // Set the rotatinal speed of the drive gear back to its default (that is, initial) value.
      resetAudio(); // Set all things audio related back to their default values.
      startButton.startButtonClicked = false; // Allow requestAnimationFrame() to be called if the Start button is clicked again. And disable the "+" and "-" buttons until Start is clicked again.
    }

    /* -- AUDIO FUNCTIONS ------------------------------------------------------------------------------------ */

    /*
      Based on the current absolute value of gears[constants.driveGearIndex].speed (i.e., the absolute value of
      the current rotational speed of the drive gear), this function calculates an appropriate audio file
      playback rate. In other words, as the drive gear speeds up, so should the sound - in a linear fashion. As
      the drive gear slow down, so should the tempo of the audio file - in a linear fashion.
    */
    function calculatePlaybackRate() {
      var yDelta = constants.initialPlaybackRate - 0; // Change in y.
      var xDelta = constants.initialDriveGearSpeed - 0; // Change in x.
      var m = yDelta / xDelta; // Slope m.
      var b = 0; // The y-intercept is 0, meaning that when the drive gear speed is 0, so is the playback rate.

      return (m * Math.abs(gears[constants.driveGearIndex].speed) + b);
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function initializeAudio() {
      if (myAudio) {
        myAudio.pause(); // Stop previous instance from playing if "Reset" button is used (and allow it to be garbage collected).
      }

      myAudio = new Audio();
      myAudio.loop = true;
      myAudio.addEventListener("loadedmetadata", function () { myAudio.defaultPlaybackRate = constants.initialPlaybackRate; myAudio.playbackRate = constants.initialPlaybackRate; }, false); // Set initial rate when engine is ready.
      myAudio.src = constants.audioFilePath;
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function startAudio() {
      myAudio.play();
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function setAudioSpeed() {

      if (gearsHaveStopped()) { // Turn sound off if the gears have visibly stopped rotating.
        myAudio.pause();
      }
      else {
        myAudio.play();
      }

      myAudio.defaultPlaybackRate = calculatePlaybackRate();
      myAudio.playbackRate = myAudio.defaultPlaybackRate;
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function pauseAudio() {
      myAudio.pause();
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function resetAudio() {
      document.getElementById("soundButton").innerHTML = "Sound Off"; // The sound doesn't start until the Start button is clicked.
      initializeAudio();
    }

    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */

    function toggleAudio() {
      myAudio.muted = !myAudio.muted;
      document.getElementById("soundButton").innerHTML = "Sound " + (myAudio.muted ? "On" : "Off");
    }
  </script>

</body></html>